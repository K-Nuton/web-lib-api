{"version":3,"sources":["components/SearchBar.tsx","handlers/DownloadHandler.tsx","utils/TimeUtils.ts","model/Diary.ts","components/DiaryList.tsx","components/DiaryModal.tsx","hooks/EditModalHooks.tsx","utils/DiaryAPI.ts","handlers/SearchHandler.tsx","handlers/ModalHandler.tsx","DiaryRoot.tsx","hooks/DiaryHooks.tsx","Login.tsx","utils/Theme.tsx","App.tsx","hooks/LoginHooks.tsx","serviceWorker.ts","index.tsx"],"names":["useStyles","makeStyles","theme","createStyles","grow","flexGrow","menuButton","marginRight","spacing","title","display","breakpoints","up","search","position","borderRadius","shape","backgroundColor","fade","palette","common","white","marginLeft","width","searchIcon","padding","height","pointerEvents","alignItems","justifyContent","inputRoot","color","inputInput","paddingLeft","transition","transitions","create","filterIcon","right","popover","popoverSearchButton","marginTop","SearchBar","onEnter","filter","userInfo","json","classes","useState","filterAnchor","setFilterAnchor","filterOpen","Boolean","filterId","undefined","handleFilterClick","useCallback","event","currentTarget","inputRef","useRef","handleFilterClose","current","value","handleInputEnter","key","handleDownloadClick","window","confirm","fileStr","JSON","stringify","blob","Blob","link","document","createElement","href","URL","createObjectURL","download","click","downloadDiaries","className","AppBar","Toolbar","IconButton","edge","aria-label","Typography","variant","noWrap","SearchTextField","filterEnabled","from","disabled","onKeyPress","onFilterClick","DateRangeSwitcher","to","open","onClose","id","onClick","UserMenu","userName","onLogout","InputBase","placeholder","root","input","inputProps","aria-controls","aria-haspopup","Popover","anchorEl","anchorOrigin","vertical","horizontal","transformOrigin","FormControlLabel","control","Switch","checked","onChange","onDisabled","target","name","label","DatePicker","date","format","disableFuture","minDate","React","setAnchorEl","isMenuOpen","handleMenuClose","menuId","Menu","keepMounted","MenuItem","encodeDate","getFullYear","zeroPadding","getMonth","getDate","getHours","getMinutes","getSeconds","fixDate","begin","result","Date","setHours","setMinutes","setSeconds","num","slice","date2String","year","month","day","hours","minutes","getDay","getDayOfTheWeek","Wheather","decodeWheather","wheather","Feeling","decodeFeeling","feeling","columns","minWidth","length","container","pagment","bottom","borderTop","margin","row","cursor","rowIndexColor","DiaryList","diaries","pageReset","onSelected","onReverse","page","setPage","rowsPerPage","setRowsPerPage","handleChangePage","newPage","handleChangeRowsPerPage","handleReverse","useEffect","Paper","TableContainer","Table","stickyHeader","TableHead","TableRow","map","column","TableCell","align","style","TableBody","diary","index","diary_id","hover","role","tabIndex","TablePagination","rowsPerPageOptions","component","count","onChangePage","onChangeRowsPerPage","modal","paper","background","maxWidth","boxShadow","shadows","enterEdit","textOverFlow","maxHeight","overflow","editTextMargin","editButtonWrapper","delete","close","DiaryModal","selectTarget","edit","normalBody","ViewBody","editBody","EditBody","Modal","aria-labelledby","aria-describedby","disableBackdropClick","closeAfterTransition","BackdropComponent","Backdrop","BackdropProps","timeout","Fade","in","disableStrictModeCompat","text","Fab","size","saveHandler","deleteHandler","cancelHandler","setDate","handleDateChange","setWheather","setFeeling","textRef","handleOnDelete","handleOnSave","handleOnClose","handleWChange","handleFChange","useEditModal","DateTimePicker","ampm","FormControl","Select","rows","defaultValue","multiline","fullWidth","rowsMax","fontSize","DiaryAPI","inner_user_id","searchInput","fromDate","toDate","end_date","original","body","fetch","this","URI","SEARCH","method","POST","headers","HEADERS","stringifyBody","res","ok","Error","statusText","encodeRaw2Diary","reverse","DIARY","PUT","DELETE","_","v","update_date","searchDiaries","setDiaries","setOriginal","getDates","a","dates","getSaveHandler","setFilter","onSearch","setModalStatus","dateHasChanged","getTime","wheatherHasChanged","feelingHasChanged","textHasChanged","alert","update","message","getDeleteHandler","getCancelHandler","getDiaryTemplate","getEmpty","insert","getDeleteAndCancelHandler","addIcon","DiaryRoot","innerUserId","setTarget","useDiaryList","resetPage","setResetPage","init_open","init_edit","setOpen","setEdit","useModal","setToDate","setFromDate","fromDisabled","setFromDisabled","toDisabled","setToDisabled","useSearchBar","getHandler","handleModalClose","createNew","toggleEdit","Copyright","Link","flexDirection","avatar","primary","main","form","submit","Login","onLogin","idRef","handleOnLogin","userId","Container","CssBaseline","Avatar","TextField","required","autoFocus","Button","type","Box","mt","createMuiTheme","secondary","App","setInnerUserId","setUserName","error","user_name","useLogin","ThemeProvider","utils","DateFnsUtils","locale","jaLocale","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","console"],"mappings":"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","file":"static/js/main.6fee9546.chunk.js","sourcesContent":["import React, { useCallback, useRef, useState } from 'react';\r\nimport { fade, makeStyles, Theme, createStyles } from '@material-ui/core/styles';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport InputBase from '@material-ui/core/InputBase';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport ImportContactsIcon from '@material-ui/icons/ImportContacts';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport AccountCircle from '@material-ui/icons/AccountCircle';\r\nimport CloudDownloadIcon from '@material-ui/icons/CloudDownload';\r\nimport FilterListIcon from '@material-ui/icons/FilterList';\r\nimport { FormControlLabel, Popover, Switch } from '@material-ui/core';\r\nimport { DatePicker } from '@material-ui/pickers';\r\nimport { MaterialUiPickersDate } from '@material-ui/pickers/typings/date';\r\nimport { downloadDiaries } from '../handlers/DownloadHandler';\r\nimport { SearchResponse } from '../utils/DiaryAPI';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    grow: {\r\n      flexGrow: 1,\r\n    },\r\n    menuButton: {\r\n      marginRight: theme.spacing(2),\r\n    },\r\n    title: {\r\n      display: 'none',\r\n      [theme.breakpoints.up('sm')]: {\r\n        display: 'block',\r\n      },\r\n    },\r\n    search: {\r\n      position: 'relative',\r\n      borderRadius: theme.shape.borderRadius,\r\n      backgroundColor: fade(theme.palette.common.white, 0.15),\r\n      '&:hover': {\r\n        backgroundColor: fade(theme.palette.common.white, 0.25),\r\n      },\r\n      marginRight: theme.spacing(2),\r\n      marginLeft: 0,\r\n      width: '100%',\r\n      [theme.breakpoints.up('sm')]: {\r\n        marginLeft: theme.spacing(3),\r\n        width: 'auto',\r\n      },\r\n    },\r\n    searchIcon: {\r\n      padding: theme.spacing(0, 2),\r\n      height: '100%',\r\n      position: 'absolute',\r\n      pointerEvents: 'none',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n    },\r\n    inputRoot: {\r\n      color: 'inherit',\r\n    },\r\n    inputInput: {\r\n      padding: theme.spacing(1, 1, 1, 0),\r\n      paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\r\n      transition: theme.transitions.create('width'),\r\n      width: '100%',\r\n      [theme.breakpoints.up('md')]: {\r\n        width: '20ch',\r\n      },\r\n    },\r\n    filterIcon: {\r\n      position: 'absolute',\r\n      right: 0,\r\n      height: '100%',\r\n      padding: '0 12px'\r\n    },\r\n    popover: {\r\n      padding: '12px',\r\n    },\r\n    popoverSearchButton: {\r\n      marginTop: '10px',\r\n      display: 'flex',\r\n      justifyContent: 'flex-end'\r\n    }\r\n  }),\r\n);\r\n\r\ntype DateSwitch = {\r\n  date: Date;\r\n  disabled: boolean;\r\n  onChange: (date: MaterialUiPickersDate) => void;\r\n  onDisabled: (disabled: boolean) => void;\r\n}\r\nexport type Filter = {\r\n  from: DateSwitch,\r\n  to: DateSwitch\r\n};\r\ntype PrimarySearchAppBar = {\r\n  onEnter: (input: string) => void;\r\n  filter: Filter;\r\n  userInfo: {\r\n    userName: string;\r\n    onLogout: () => void;\r\n  },\r\n  json: SearchResponse\r\n};\r\nexport default function SearchBar({ onEnter, filter, userInfo, json }: PrimarySearchAppBar) {\r\n  const classes = useStyles();\r\n\r\n  const [filterAnchor, setFilterAnchor] = useState<HTMLButtonElement | null>(null);\r\n  const filterOpen = Boolean(filterAnchor);\r\n  const filterId = filterOpen ? 'filter-popover' : undefined;\r\n  \r\n  const handleFilterClick = useCallback((event: React.MouseEvent<HTMLButtonElement>) => {\r\n    setFilterAnchor(event.currentTarget);\r\n  }, [setFilterAnchor]);\r\n\r\n  const inputRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const handleFilterClose = useCallback(() => {\r\n    onEnter(inputRef.current ? inputRef.current.value : \"\");\r\n    setFilterAnchor(null);\r\n  }, [onEnter, setFilterAnchor]);\r\n\r\n  const handleInputEnter = useCallback((event: React.KeyboardEvent<HTMLDivElement>): void => {\r\n    if ('Enter' === event.key)\r\n      onEnter(inputRef.current ? inputRef.current.value : \"\");\r\n  }, [onEnter]);\r\n\r\n  const handleDownloadClick = useCallback(() => downloadDiaries(json), [json]);\r\n  \r\n  return (\r\n    <div className={classes.grow}>\r\n      <AppBar position=\"static\">\r\n        <Toolbar>\r\n          <IconButton\r\n            edge=\"start\"\r\n            className={classes.menuButton}\r\n            color=\"inherit\"\r\n            aria-label=\"open drawer\"\r\n          >\r\n            <ImportContactsIcon />\r\n          </IconButton>\r\n          <Typography className={classes.title} variant=\"h6\" noWrap>\r\n            Web Diary\r\n          </Typography>\r\n          <div className={classes.search}>\r\n            <SearchTextField \r\n              inputRef={inputRef}\r\n              filterId={filterId}\r\n              filterEnabled={!filter.from.disabled}\r\n              onKeyPress={handleInputEnter}\r\n              onFilterClick={handleFilterClick}\r\n            />\r\n            <DateRangeSwitcher \r\n              from={filter.from}\r\n              to={filter.to}\r\n              open={filterOpen}\r\n              filterAnchor={filterAnchor}\r\n              onClose={handleFilterClose}\r\n              id={filterId}\r\n            />\r\n          </div>\r\n          <IconButton color='inherit' onClick={handleDownloadClick}>\r\n            <CloudDownloadIcon />\r\n          </IconButton>\r\n          <UserMenu userName={userInfo.userName} onLogout={userInfo.onLogout} />\r\n        </Toolbar>\r\n      </AppBar>\r\n    </div>\r\n  );\r\n}\r\n\r\ntype SearchTextField = {\r\n  onKeyPress: ((event: React.KeyboardEvent<HTMLDivElement>) => void) | undefined;\r\n  onFilterClick: (event: React.MouseEvent<HTMLButtonElement>) => void;\r\n  filterId: string | undefined;\r\n  filterEnabled: boolean;\r\n  inputRef: React.RefObject<HTMLTextAreaElement>;\r\n}\r\nfunction SearchTextField({ onKeyPress, onFilterClick, filterId, filterEnabled, inputRef }: SearchTextField): JSX.Element {\r\n  const classes = useStyles();\r\n  return (\r\n    <>\r\n      <div className={classes.searchIcon}>\r\n        <SearchIcon />\r\n      </div>\r\n      <InputBase\r\n        inputRef={inputRef}\r\n        placeholder=\"Search…\"\r\n        onKeyPress={onKeyPress}\r\n        classes={{\r\n        root: classes.inputRoot,\r\n        input: classes.inputInput,\r\n        }}\r\n        inputProps={{ 'aria-label': 'search' }}\r\n      />\r\n      <IconButton \r\n        className={classes.filterIcon}\r\n        aria-label=\"date-filter\"\r\n        aria-controls={filterId}\r\n        aria-haspopup=\"true\"\r\n        color={filterEnabled ? 'inherit' : 'secondary'}\r\n        onClick={onFilterClick}\r\n      >\r\n        <FilterListIcon />\r\n      </IconButton>\r\n    </>\r\n  );\r\n}\r\n\r\ntype Switcher = {\r\n  from: DateSwitch;\r\n  to: DateSwitch;\r\n  open: boolean;\r\n  filterAnchor: HTMLButtonElement | null;\r\n  onClose: () => any;\r\n  id: string | undefined;\r\n};\r\nfunction DateRangeSwitcher({ from, to, open, filterAnchor, onClose, id }: Switcher): JSX.Element {\r\n  const classes = useStyles();\r\n\r\n  const handleSwitchChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    from.onDisabled(!event.target.checked);\r\n    if (!event.target.checked)\r\n      to.onDisabled(!event.target.checked);\r\n  };\r\n\r\n  const handleToSwitchChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    to.onDisabled(!event.target.checked);\r\n  };\r\n\r\n  return (\r\n    <Popover\r\n      id={id}\r\n      open={open}\r\n      anchorEl={filterAnchor}\r\n      onClose={onClose}\r\n      anchorOrigin={{\r\n        vertical: 'bottom',\r\n        horizontal: 'center'\r\n      }}\r\n      transformOrigin={{\r\n        vertical: 'top',\r\n        horizontal: 'center'\r\n      }}\r\n    >\r\n      <div className={classes.popover}>\r\n        <FormControlLabel \r\n          control={\r\n            <Switch\r\n              checked={!from.disabled}\r\n              onChange={handleSwitchChange}\r\n              color='primary'\r\n              name='switch date filter'\r\n              inputProps={{ 'aria-label': 'enable date filter' }}\r\n            />\r\n          }\r\n          label=\"enable date filter\"\r\n        />\r\n        <div>\r\n          <DatePicker \r\n            disabled={from.disabled}\r\n            label=\"from\"\r\n            variant='inline'\r\n            value={from.date}\r\n            onChange={from.onChange}\r\n            format='yyyy/MM/dd'\r\n            disableFuture\r\n          />\r\n          <div>\r\n            <Switch\r\n              disabled={from.disabled}\r\n              checked={!to.disabled}\r\n              onChange={handleToSwitchChange}\r\n              color=\"primary\"\r\n              name=\"switch to date\"\r\n              inputProps={{ 'aria-label': 'to date checkbox' }}\r\n            />\r\n            <DatePicker \r\n              label=\"to\"\r\n              variant='inline'\r\n              value={to.date}\r\n              onChange={to.onChange}\r\n              format='yyyy/MM/dd'\r\n              disableFuture\r\n              disabled={to.disabled}\r\n              minDate={from.date}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Popover>\r\n  );\r\n}\r\n\r\ntype UserMenu = {\r\n  userName: string;\r\n  onLogout: () => void;\r\n}\r\nfunction UserMenu({ userName, onLogout }: UserMenu): JSX.Element {\r\n  const classes = useStyles();\r\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\r\n\r\n  const isMenuOpen = Boolean(anchorEl);\r\n\r\n  const handleProfileMenuOpen = (event: React.MouseEvent<HTMLElement>) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleMenuClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const menuId = 'primary-search-account-menu';\r\n\r\n  return (\r\n    <>\r\n      <div className={classes.grow} />\r\n        <IconButton\r\n          aria-label=\"account of current user\"\r\n          aria-controls={menuId}\r\n          aria-haspopup=\"true\"\r\n          onClick={handleProfileMenuOpen}\r\n          color=\"inherit\"\r\n        >\r\n          <AccountCircle />\r\n        </IconButton>\r\n        <Menu\r\n          anchorEl={anchorEl}\r\n          anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\r\n          id={menuId}\r\n          keepMounted\r\n          transformOrigin={{ vertical: 'top', horizontal: 'right' }}\r\n          open={isMenuOpen}\r\n          onClose={handleMenuClose}\r\n        >\r\n          <MenuItem onClick={handleMenuClose}>{userName}</MenuItem>\r\n          <MenuItem onClick={onLogout}>Logout</MenuItem>\r\n        </Menu>\r\n    </>\r\n  )\r\n}","import { SearchResponse } from \"../utils/DiaryAPI\";\r\n\r\nexport function downloadDiaries(json: SearchResponse): void {\r\n  const result = window.confirm('日記JSONをダウンロードします');\r\n  if (!result) return;\r\n\r\n  const fileStr = JSON.stringify(json);\r\n\r\n  const blob = new Blob(\r\n    [fileStr],\r\n    {\"type\": \"text/plain\"}\r\n  );\r\n\r\n  const link = document.createElement('a');\r\n  link.href = window.URL.createObjectURL(blob);\r\n  link.download = 'diaries.json';\r\n  link.click();\r\n}","\r\nexport default function encodeDate(date: Date) {\r\n  return (\r\n    date.getFullYear() + '-' + \r\n        zeroPadding(date.getMonth() + 1) + '-' + \r\n        zeroPadding(date.getDate()) + 'T' +\r\n        zeroPadding(date.getHours()) + ':' +\r\n        zeroPadding(date.getMinutes()) + ':' +\r\n        zeroPadding(date.getSeconds()) + '.0'\r\n  );\r\n}\r\n\r\nexport function fixDate(date: Date, begin: boolean): Date {\r\n  const result = new Date(date);\r\n\r\n  result.setHours(begin ? 0 : 23);\r\n  result.setMinutes(begin ? 0 : 59);\r\n  result.setSeconds(begin ? 0 : 59);\r\n\r\n  return result;\r\n}\r\n\r\nfunction zeroPadding(num: number): string {\r\n  return ('0' + num).slice(-2);\r\n}\r\n\r\nexport function date2String(date: Date): string {\r\n  const year = date.getFullYear();\r\n  const month = date.getMonth() + 1;\r\n  const day = date.getDate();\r\n  const hours = date.getHours();\r\n  const minutes = date.getMinutes();\r\n\r\n  return `${year}/${month}/${day} ${getDayOfTheWeek(date)} ${hours}:${minutes}`;\r\n}\r\n\r\nfunction getDayOfTheWeek(date: Date): string {\r\n  return [\"日\", \"月\", \"火\", \"水\", \"木\", \"金\", \"土\"][date.getDay()];\r\n}","export type RawDiary = {\r\n  inner_user_id: number;\r\n  diary_id: number;\r\n  date: string;\r\n  update_date: string;\r\n  wheather: number;\r\n  feeling: number;\r\n  text: string;\r\n};\r\n\r\nexport type Diary = {\r\n  inner_user_id?: number;\r\n  diary_id?: number;\r\n  date: Date;\r\n  end_date?: Date;\r\n  update_date?: Date;\r\n  wheather: number;\r\n  feeling: number;\r\n  text: string;\r\n};\r\n\r\nconst Wheather = {\r\n  SUNNY: 0,\r\n  CLOUDY: 1,\r\n  RAINY: 2,\r\n  THUNDER: 3,\r\n  SNOW: 4,\r\n  WIND: 5\r\n} as const;\r\ntype Wheather = typeof Wheather[keyof typeof Wheather];\r\n\r\nfunction decodeWheather(wheather: number): string {\r\n  switch(wheather) {\r\n    case(Wheather.SUNNY):\r\n      return '🔆';\r\n    case(Wheather.CLOUDY):\r\n      return '☁';\r\n    case(Wheather.RAINY):\r\n      return '☔';\r\n    case(Wheather.THUNDER):\r\n      return '⚡';\r\n    case(Wheather.SNOW):\r\n      return '⛄';\r\n    case(Wheather.WIND):\r\n      return '🌀';\r\n    default:\r\n      return '🔆';\r\n  };\r\n}\r\n\r\nconst Feeling = {\r\n  HAPPY: 0,\r\n  NORMAL: 1,\r\n  LIT_SAD: 2,\r\n  SAD: 3,\r\n  ANGRY: 4\r\n} as const;\r\ntype Feeling = typeof Feeling[keyof typeof Feeling];\r\n\r\nfunction decodeFeeling(feeling: number): string {\r\n  switch(feeling) {\r\n    case(Feeling.HAPPY):\r\n      return '😀';\r\n    case(Feeling.NORMAL):\r\n      return '😐';\r\n    case(Feeling.LIT_SAD):\r\n      return '😥';\r\n    case(Feeling.SAD):\r\n      return '😭';\r\n    case(Feeling.ANGRY):\r\n      return '😡';\r\n    default:\r\n      return '😀';\r\n  };\r\n}\r\n\r\nexport { Wheather, decodeWheather, Feeling, decodeFeeling };","import React, { useEffect } from 'react';\r\nimport { useState, useCallback } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TablePagination from '@material-ui/core/TablePagination';\r\nimport TableRow from '@material-ui/core/TableRow';\r\n\r\nimport { date2String } from '../utils/TimeUtils';\r\nimport { Diary, decodeWheather, decodeFeeling } from '../model/Diary';\r\n\r\ntype Column = {\r\n  id: 'date' | 'wheather' | 'feeling' | 'text';\r\n  label: string;\r\n  minWidth?: number;\r\n  align?: 'center';\r\n  format?: (value: any) => string;\r\n};\r\n\r\nconst columns: Column[] = [\r\n  { id: 'date', label: 'Date', minWidth: 50, format: (value: Date) => date2String(value) },\r\n  { id: 'wheather', label: '', minWidth: 50, format: (value: number) => decodeWheather(value) },\r\n  { id: 'feeling', label: '', minWidth: 50, format: (value: number) => decodeFeeling(value) },\r\n  { id: 'text', label: 'Export', minWidth: 170, format: (value: string) => value.length > 100 ? value.slice(0, 100) + '...' : value }\r\n];\r\n\r\nconst useStyles = makeStyles({\r\n  root: {\r\n    width: '100%'\r\n  },\r\n  container: {\r\n    height: 'calc(100vh - 115px)'\r\n  },\r\n  pagment: {\r\n    position: 'absolute',\r\n    bottom: 0,\r\n    backgroundColor: '#fafafa',\r\n    borderTop: '1px solid rgba(0, 0, 0, 0.15)',\r\n    width: '100%',\r\n    margin: 0\r\n  },\r\n  row: {\r\n    cursor: 'pointer'\r\n  },\r\n  rowIndexColor: {\r\n    backgroundColor: \"#e6f6ea\"\r\n  }\r\n});\r\n\r\ntype DiaryList = {\r\n  diaries: Diary[];\r\n  pageReset: boolean;\r\n  onSelected: (target: Diary) => void;\r\n  onReverse: (diaries: Diary[]) => void;\r\n};\r\nexport default function DiaryList({ diaries, pageReset, onSelected, onReverse }: DiaryList) {\r\n  const classes = useStyles();\r\n  const [page, setPage] = useState(0);\r\n  const [rowsPerPage, setRowsPerPage] = useState(25);\r\n\r\n  const handleChangePage = useCallback((event: unknown, newPage: number) => {\r\n    setPage(newPage);\r\n  }, []);\r\n\r\n  const handleChangeRowsPerPage = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    setRowsPerPage(+event.target.value);\r\n    setPage(0);\r\n  }, []);\r\n\r\n  const handleReverse = useCallback(() => onReverse(diaries), [diaries, onReverse]);\r\n\r\n  useEffect(() => pageReset ? setPage(0) : void(0), [pageReset]);\r\n\r\n  return (\r\n    <Paper className={classes.root}>\r\n      <TableContainer className={classes.container}>\r\n        <Table stickyHeader aria-label=\"sticky table\">\r\n          <TableHead>\r\n            <TableRow onClick={handleReverse}>\r\n              {columns.map((column) => (\r\n                <TableCell\r\n                  key={column.id}\r\n                  align={column.align}\r\n                  style={{ minWidth: column.minWidth }}\r\n                >\r\n                  {column.label}\r\n                </TableCell>\r\n              ))}\r\n            </TableRow>\r\n          </TableHead>\r\n          <TableBody>\r\n            {diaries.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage).map((diary, index) => {\r\n              return (\r\n                <TableRow\r\n                  className={classes.row + \" \" + (index%2===0 ? classes.rowIndexColor : \"\")}\r\n                  key={diary.diary_id}\r\n                  hover \r\n                  role=\"checkbox\" \r\n                  tabIndex={-1}\r\n                  onClick={(event) => onSelected(diary)}\r\n                >\r\n                  {columns.map((column) => {\r\n                    const value = diary[column.id];\r\n                    return (\r\n                      <TableCell key={column.id} align={column.align}>\r\n                        {column.format ? column.format(value) : value}\r\n                      </TableCell>\r\n                    );\r\n                  })}\r\n                </TableRow>\r\n              );\r\n            })}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n      <TablePagination\r\n        className={classes.pagment}\r\n        rowsPerPageOptions={[10, 25, 100]}\r\n        component=\"div\"\r\n        count={diaries.length}\r\n        rowsPerPage={rowsPerPage}\r\n        page={page}\r\n        onChangePage={handleChangePage}\r\n        onChangeRowsPerPage={handleChangeRowsPerPage}\r\n      />\r\n    </Paper>\r\n  );\r\n}\r\n\r\n","import { createStyles, FormControl, InputBase, makeStyles, MenuItem, Modal, Select, Theme } from '@material-ui/core';\r\nimport Backdrop from '@material-ui/core/Backdrop';\r\nimport Fade from '@material-ui/core/Fade';\r\nimport React from 'react';\r\nimport { DateTimePicker } from '@material-ui/pickers';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport EditIcon from '@material-ui/icons/Edit';\r\nimport NavigationIcon from '@material-ui/icons/Navigation';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\n\r\nimport {\r\n  Diary, Wheather, Feeling, decodeWheather, decodeFeeling\r\n} from '../model/Diary';\r\nimport useEditModal from '../hooks/EditModalHooks';\r\nimport { SelectTarget } from '../hooks/DiaryHooks';\r\nimport { date2String } from '../utils/TimeUtils';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    modal: {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n    },\r\n    paper: {\r\n      position: 'relative',\r\n      backgroundColor: theme.palette.background.paper,\r\n      width: '80%',\r\n      maxWidth: '768px',\r\n      boxShadow: theme.shadows[5],\r\n      padding: theme.spacing(2, 4, 3),\r\n      borderRadius: '10px',\r\n      '& h2, p': {\r\n        cursor: 'default'\r\n      }\r\n    },\r\n    enterEdit: {\r\n      position: 'relative',\r\n      display: 'flex',\r\n      justifyContent: 'flex-end',\r\n      marginTop: '1%'\r\n    },\r\n    textOverFlow: {\r\n      width: '100%',\r\n      margin: 0,\r\n      maxHeight: '50vh',\r\n      overflow: 'auto'\r\n    },\r\n    editTextMargin: {\r\n      marginTop: '1%',\r\n    },\r\n    editButtonWrapper: {\r\n      width: '100%',\r\n      display: 'flex',\r\n      justifyContent: 'space-evenly'\r\n    },\r\n    delete: {\r\n      width: '50%'\r\n    },\r\n    close: {\r\n      width: '50%',\r\n      display: 'flex',\r\n      justifyContent: 'flex-end',\r\n      '& button': {\r\n        marginLeft: '1%'\r\n      }\r\n    }\r\n  }),\r\n);\r\n\r\ntype DiaryModal = {\r\n  selectTarget: SelectTarget;\r\n  open: boolean;\r\n  edit: boolean;\r\n  enterEdit: () => void;\r\n  onClose: () => void;\r\n}\r\nexport default function DiaryModal({ selectTarget, open, edit, enterEdit, onClose }: DiaryModal): JSX.Element {\r\n  const classes = useStyles();\r\n\r\n  const normalBody = (\r\n    <ViewBody\r\n      diary={selectTarget.diary}\r\n      onClick={enterEdit}\r\n    />\r\n  );\r\n\r\n  const editBody = (\r\n    <EditBody\r\n      selectTarget={selectTarget}\r\n    />\r\n  );\r\n  \r\n  return (\r\n    <Modal\r\n      aria-labelledby='transition-modal-title'\r\n      aria-describedby='transition-modal-description'\r\n      disableBackdropClick={edit}\r\n      className={classes.modal}\r\n      open={open}\r\n      onClose={onClose}\r\n      closeAfterTransition\r\n      BackdropComponent={Backdrop}\r\n      BackdropProps={{\r\n        timeout: 500,\r\n      }}\r\n    >\r\n      <Fade in={open} disableStrictModeCompat>\r\n        <>\r\n          {edit ? editBody : normalBody}\r\n        </>\r\n      </Fade>\r\n    </Modal>\r\n  );\r\n}\r\n\r\ntype ViewBody = {\r\n  diary: Diary;\r\n  onClick: () => void;\r\n}\r\nexport function ViewBody({ diary, onClick }: ViewBody) {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <div className={classes.paper}>\r\n      <h2 id='transition-modal-title'>\r\n        {date2String(diary.date) + \" \" + decodeWheather(diary.wheather) + \" \" + decodeFeeling(diary.feeling)}\r\n      </h2>\r\n      <p id='transition-modal-description' className={classes.textOverFlow}>{diary.text}</p>\r\n      <div className={classes.enterEdit}>\r\n        <Fab color=\"secondary\" aria-label=\"edit\" size='medium' onClick={onClick}>\r\n          <EditIcon />\r\n        </Fab>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ntype EditBody = {\r\n  selectTarget: SelectTarget;\r\n}\r\nexport function EditBody({ selectTarget }: EditBody) {\r\n  const classes = useStyles();\r\n  const { diary } = selectTarget;\r\n  const { \r\n    date, wheather, feeling, textRef,\r\n    handleDateChange, handleWChange, handleFChange,\r\n    handleOnSave, handleOnClose, handleOnDelete\r\n  } = useEditModal(selectTarget);\r\n\r\n  return (\r\n    <div className={classes.paper}>\r\n      <DateTimePicker \r\n        value={date} \r\n        variant='inline'\r\n        onChange={handleDateChange}\r\n        ampm={false}\r\n        disableFuture\r\n        format='yyyy/MM/dd HH:mm'\r\n      />\r\n      <FormControl >\r\n        <Select \r\n          value={wheather}\r\n          onChange={handleWChange}\r\n        > \r\n          <MenuItem value={Wheather.SUNNY}>\r\n            <span role='img' aria-label='sunny'>{decodeWheather(Wheather.SUNNY)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Wheather.CLOUDY}>\r\n            <span role='img' aria-label='cloudy'>{decodeWheather(Wheather.CLOUDY)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Wheather.RAINY}>\r\n            <span role='img' aria-label='rainy'>{decodeWheather(Wheather.RAINY)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Wheather.THUNDER}>\r\n            <span role='img' aria-label='thunder'>{decodeWheather(Wheather.THUNDER)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Wheather.SNOW}>\r\n            <span role='img' aria-label='snow'>{decodeWheather(Wheather.SNOW)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Wheather.WIND}>\r\n            <span role='img' aria-label='wind'>{decodeWheather(Wheather.WIND)}</span>\r\n          </MenuItem>\r\n        </Select>\r\n      </FormControl>\r\n      <FormControl>\r\n        <Select\r\n          value={feeling}\r\n          onChange={handleFChange}\r\n        >\r\n          <MenuItem value={Feeling.HAPPY}>\r\n            <span role='img' aria-label='happy'>{decodeFeeling(Feeling.HAPPY)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Feeling.NORMAL}>\r\n            <span role='img' aria-label='normal'>{decodeFeeling(Feeling.NORMAL)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Feeling.LIT_SAD}>\r\n            <span role='img' aria-label='little-bit-sad'>{decodeFeeling(Feeling.LIT_SAD)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Feeling.SAD}>\r\n            <span role='img' aria-label='sad'>{decodeFeeling(Feeling.SAD)}</span>\r\n          </MenuItem>\r\n          <MenuItem value={Feeling.ANGRY}>\r\n            <span role='img' aria-label='angry'>{decodeFeeling(Feeling.ANGRY)}</span>\r\n          </MenuItem>\r\n        </Select>\r\n      </FormControl>\r\n      <InputBase\r\n        inputRef={textRef}\r\n        className={classes.editTextMargin}\r\n        rows={20}\r\n        defaultValue={diary.text}\r\n        multiline\r\n        fullWidth\r\n        rowsMax={20}\r\n        inputProps={{ 'aria-label': 'naked' }}\r\n      />\r\n      <div className={classes.editButtonWrapper}>\r\n        <div className={classes.delete}>\r\n          <IconButton\r\n            onClick={handleOnDelete}\r\n            aria-label=\"delete\"\r\n          >\r\n            <DeleteIcon fontSize=\"small\" />\r\n          </IconButton>\r\n        </div>\r\n        <div className={classes.close}>\r\n          <Fab\r\n            onClick={handleOnSave}\r\n            variant=\"extended\"\r\n            size=\"medium\"\r\n            color=\"primary\"\r\n            aria-label=\"add\"\r\n          >\r\n            <NavigationIcon />\r\n            保存\r\n          </Fab>\r\n          <IconButton \r\n            aria-label='close' \r\n            onClick={handleOnClose}\r\n          >\r\n            <CloseIcon fontSize='small'/>\r\n          </IconButton>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { RefObject, useCallback, useRef, useState } from \"react\";\r\nimport { SelectTarget } from \"./DiaryHooks\";\r\n\r\nexport type UseEditModal = {\r\n  date: Date;\r\n  wheather: number;\r\n  feeling: number;\r\n  textRef: RefObject<HTMLTextAreaElement>;\r\n  handleDateChange: (date: any) => void;\r\n  handleWChange: (event: React.ChangeEvent<{value: unknown;}>) => void;\r\n  handleFChange: (event: React.ChangeEvent<{value: unknown;}>) => void;\r\n  handleOnSave: () => void;\r\n  handleOnClose: () => void;\r\n  handleOnDelete: () => void\r\n}\r\nexport default function useEditModal(selectTarget: SelectTarget): UseEditModal {\r\n  const { diary, saveHandler, deleteHandler, cancelHandler } = selectTarget;\r\n\r\n  const [date, setDate] = useState(diary.date);\r\n  const handleDateChange = useCallback((date) => setDate(date), []);\r\n\r\n  const [wheather, setWheather] = useState(diary.wheather);\r\n  const handleWChange = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n    setWheather(event.target.value as number);\r\n  };\r\n  \r\n  const [feeling, setFeeling] = useState(diary.feeling);\r\n  const handleFChange = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n    setFeeling(event.target.value as number);\r\n  };\r\n\r\n  const textRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const handleOnDelete = useCallback(() => {\r\n    deleteHandler()\r\n  }, [deleteHandler]);\r\n  \r\n  const handleOnSave = useCallback(() => {\r\n    const text = textRef.current ? textRef.current.value : \"\";\r\n    saveHandler({ date, wheather, feeling, text });\r\n  }, [date, feeling, saveHandler, wheather]);\r\n\r\n  const handleOnClose = useCallback(() => {\r\n    cancelHandler();\r\n  }, [cancelHandler]);\r\n\r\n  return {\r\n    date, \r\n    wheather, \r\n    feeling, \r\n    textRef,\r\n    handleDateChange, \r\n    handleWChange, \r\n    handleFChange,\r\n    handleOnDelete,\r\n    handleOnSave,\r\n    handleOnClose\r\n  };\r\n}","import { RawDiary, Diary } from '../model/Diary';\r\nimport encodeDate, { fixDate } from './TimeUtils';\r\n\r\nexport type SearchResponse = {\r\n  diaries: RawDiary[]\r\n};\r\nexport default class DiaryAPI {\r\n  private static URI = '../web_diary/';\r\n  private static DIARY = 'diary/';\r\n  private static SEARCH = 'search/';\r\n\r\n  private static POST = 'POST';\r\n  private static PUT = 'PUT';\r\n  private static DELETE = 'DELETE';\r\n\r\n  private static HEADERS = {\r\n    'Content-Type': 'application/json'\r\n  };\r\n\r\n  public static async search(\r\n    inner_user_id: number, \r\n    searchInput: string | null, \r\n    fromDate: Date | null, \r\n    toDate: Date | null\r\n  ): Promise<{\r\n    diaries: Diary[],\r\n    original: SearchResponse\r\n  }> {\r\n\r\n    let date: Date | null;\r\n    let end_date: Date | null;\r\n    if (fromDate && toDate) {\r\n      date = fixDate(fromDate, true);\r\n      end_date = fixDate(toDate, false);\r\n    } else if (fromDate && !toDate) {\r\n      date = fixDate(fromDate, true);\r\n      end_date = fixDate(fromDate, false);\r\n    } else {\r\n      date = null;\r\n      end_date = null;\r\n    }\r\n\r\n    if (!fromDate && !toDate && !searchInput) return { diaries: [], original: { diaries: [] } };\r\n\r\n    const body = {\r\n      inner_user_id,\r\n      text: searchInput,\r\n      date: date && encodeDate(date),\r\n      end_date: end_date && encodeDate(end_date)\r\n    };\r\n\r\n    const res = await fetch(\r\n      `${this.URI}${this.SEARCH}`,\r\n      {\r\n        method: this.POST,\r\n        headers: this.HEADERS,\r\n        body: this.stringifyBody(body)\r\n      }\r\n    );\r\n\r\n    if (!res.ok) throw new Error(res.statusText);\r\n\r\n    const json: SearchResponse = await res.json();\r\n\r\n    return {\r\n      diaries: json.diaries.map(this.encodeRaw2Diary).reverse(),\r\n      original: json\r\n    };\r\n  }\r\n\r\n  public static async insert(\r\n    inner_user_id: number,\r\n    date: Date,\r\n    wheather: number,\r\n    feeling: number,\r\n    text: string\r\n  ): Promise<Diary> {\r\n    const res = await fetch(\r\n      `${this.URI}${this.DIARY}`,\r\n      {\r\n        method: this.POST,\r\n        headers: this.HEADERS,\r\n        body: this.stringifyBody({\r\n          inner_user_id,\r\n          date: encodeDate(date),\r\n          wheather,\r\n          feeling,\r\n          text\r\n        })\r\n      }\r\n    );\r\n\r\n    if (!res.ok) throw new Error(res.statusText);\r\n\r\n    return (await res.json()) as Diary;\r\n  }\r\n\r\n  public static async update(\r\n    diary_id: number,\r\n    date: Date | null,\r\n    wheather: number | null,\r\n    feeling: number | null,\r\n    text: string | null\r\n  ): Promise<Diary> {\r\n    \r\n    const body = {\r\n      diary_id,\r\n      date: date && encodeDate(date),\r\n      wheather,\r\n      feeling,\r\n      text\r\n    };\r\n\r\n    const res = await fetch(\r\n      `${this.URI}${this.DIARY}`,\r\n      {\r\n        method: this.PUT,\r\n        headers: this.HEADERS,\r\n        body: this.stringifyBody(body)\r\n      }\r\n    );\r\n\r\n    if (!res.ok) throw new Error(res.statusText);\r\n\r\n    return (await res.json()) as Diary;\r\n  }\r\n\r\n  public static async delete(diary_id: number): Promise<void> {\r\n    const res = await fetch(\r\n      `${this.URI}${this.DIARY}${diary_id}`,\r\n      { method: this.DELETE }\r\n    );\r\n\r\n    if (!res.ok) throw new Error(res.statusText);\r\n  }\r\n\r\n  private static stringifyBody(body: any): string {\r\n    return JSON.stringify(body, (_, v) => v != null ? v : undefined);\r\n  }\r\n\r\n  private static encodeRaw2Diary({ \r\n    inner_user_id,\r\n    diary_id,\r\n    date,\r\n    update_date,\r\n    wheather,\r\n    feeling,\r\n    text\r\n   }: RawDiary): Diary {\r\n    return {\r\n      inner_user_id,\r\n      diary_id,\r\n      date: new Date(date),\r\n      update_date: new Date(update_date),\r\n      wheather,\r\n      feeling,\r\n      text\r\n    };\r\n  }\r\n}","import { SelectTarget } from \"../hooks/DiaryHooks\";\r\nimport { Diary } from \"../model/Diary\";\r\nimport DiaryAPI, { SearchResponse } from \"../utils/DiaryAPI\";\r\nimport { fixDate } from \"../utils/TimeUtils\";\r\n\r\nexport type OnSearch = (input: string, from?: Date, to?: Date) => Promise<void>;\r\nexport default function searchDiaries(\r\n  inner_user_id: number,\r\n  setDiaries: (value: React.SetStateAction<Diary[]>) => void,\r\n  setOriginal: (value: React.SetStateAction<SearchResponse>) => void,\r\n  setPage: (value: React.SetStateAction<boolean>) => void,\r\n  getDates: () => [Date | null, Date | null]\r\n): OnSearch {\r\n  return async function onSearch(input: string, from, to): Promise<void> {\r\n    const text: string | null = input === \"\" ? null : input;\r\n\r\n    const dates = (from && to) ? [fixDate(from, true), fixDate(to, false)] : getDates();\r\n\r\n    try {\r\n      const { diaries, original } = await DiaryAPI.search(\r\n        inner_user_id,\r\n        text,\r\n        dates[0],\r\n        dates[1]\r\n      );\r\n\r\n      setOriginal({ ...original });\r\n      setDiaries(diaries);\r\n    } catch(e) {\r\n      setDiaries([]);\r\n    } finally {\r\n      setPage(true);\r\n      setPage(false)\r\n    }\r\n  };\r\n}\r\n\r\nexport function getHandler(\r\n  target: Diary,\r\n  setFilter: (from: Date, to: Date, fromDisabled: boolean, toDisabled: boolean) => void,\r\n  onSearch: OnSearch,\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): SelectTarget {\r\n  return {\r\n    diary: target,\r\n    saveHandler: getSaveHandler(target, setFilter, onSearch, setModalStatus),\r\n    deleteHandler: getDeleteHandler(target, setFilter, onSearch, setModalStatus),\r\n    cancelHandler: getCancelHandler(target, setModalStatus)\r\n  };\r\n}\r\n\r\nfunction getSaveHandler(\r\n  target: Diary,\r\n  setFilter: (from: Date, to: Date, fromDisabled: boolean, toDisabled: boolean) => void,\r\n  onSearch: OnSearch,\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): ({ date, wheather, feeling, text }: Diary) => Promise<void> {\r\n  return async ({ date, wheather, feeling, text }) => {\r\n    const dateHasChanged = target.date.getTime() !== date.getTime();\r\n    const wheatherHasChanged  = target.wheather !== wheather;\r\n    const feelingHasChanged = target.feeling !== feeling;\r\n    const textHasChanged = target.text !== text;\r\n\r\n    if (!target.diary_id) return;\r\n    if (!(dateHasChanged || wheatherHasChanged || feelingHasChanged || textHasChanged)) {\r\n      alert('変更がありません');\r\n      return;\r\n    }\r\n\r\n    if (text.length < 10) {\r\n      alert('本文は10文字以上入力してください');\r\n      return;\r\n    }\r\n\r\n    const result = window.confirm('更新します');\r\n    if (!result) return;\r\n\r\n    try {\r\n      await DiaryAPI.update(\r\n        target.diary_id,\r\n        dateHasChanged ? date : null,\r\n        wheatherHasChanged ? wheather : null,\r\n        feelingHasChanged ? feeling : null,\r\n        textHasChanged ? text : null\r\n      );\r\n    } catch(e) {\r\n      alert(`更新できませんでした。 詳細: ${e.message}`);\r\n    } finally {\r\n      setFilter(date, date, false, true);\r\n      onSearch(\"\", date, date);\r\n      setModalStatus(false, null);\r\n    }\r\n  }\r\n}\r\n\r\nfunction getDeleteHandler(\r\n  target: Diary,\r\n  setFilter: (from: Date, to: Date, fromDisabled: boolean, toDisabled: boolean) => void,\r\n  onSearch: OnSearch,\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): () => Promise<void> {\r\n  return async () => {\r\n    const result = window.confirm('本当に削除していいですか?');\r\n    if (!result) return;\r\n\r\n    if (target.diary_id === undefined) return;\r\n    try {\r\n      await DiaryAPI.delete(target.diary_id);\r\n  \r\n    } catch(e) {\r\n      alert(`削除できませんでした。 詳細: ${e.message}`);\r\n    } finally {\r\n      const to =new Date();\r\n      const from = new Date(to.getFullYear(), to.getMonth()-2, to.getDate());\r\n      setFilter(\r\n        from, to, false, false\r\n      );\r\n      onSearch(\"\", from, to);\r\n      setModalStatus(false, null)\r\n    }\r\n  }\r\n}\r\n\r\nfunction getCancelHandler(\r\n  target: Diary,\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): () => Promise<void> {\r\n  return async () => {\r\n    const result = window.confirm('変更を破棄します');\r\n    if (!result) return;\r\n    setModalStatus(false, null);\r\n  };\r\n}\r\n","import { SelectTarget } from \"../hooks/DiaryHooks\";\r\nimport { Diary } from \"../model/Diary\";\r\nimport DiaryAPI from \"../utils/DiaryAPI\";\r\nimport { OnSearch } from \"./SearchHandler\";\r\n\r\nexport default function getDiaryTemplate(\r\n  inner_user_id: number,\r\n  setFilter: (from: Date, to: Date, fromDisabled: boolean, toDisabled: boolean) => void,\r\n  onSearch: OnSearch,\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): SelectTarget {\r\n  const diary = getEmpty(inner_user_id);\r\n\r\n  const saveHandler = getSaveHandler(diary, setFilter, onSearch, setModalStatus);\r\n  const deleteHandler = getDeleteAndCancelHandler(setModalStatus);\r\n  return {\r\n    diary,\r\n    saveHandler,\r\n    deleteHandler,\r\n    cancelHandler: deleteHandler\r\n  }\r\n}\r\n\r\nfunction getEmpty(inner_user_id: number): Diary {\r\n  return {\r\n    inner_user_id,\r\n    date: new Date(),\r\n    wheather: 0,\r\n    feeling: 0,\r\n    text: '',\r\n  }\r\n}\r\n\r\nfunction getSaveHandler(\r\n  target: Diary,\r\n  setFilter: (from: Date, to: Date, fromDisabled: boolean, toDisabled: boolean) => void,\r\n  onSearch: OnSearch,\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): ({ date, wheather, feeling, text }: Diary) => Promise<void> {\r\n  if (target.inner_user_id === undefined) throw new Error('ログインしなおしてください');\r\n\r\n  return async ({ date, wheather, feeling, text} ) => {\r\n    if (text.length < 10) {\r\n      alert('本文は10文字以上入力してください');\r\n      return;\r\n    }\r\n\r\n    const result = window.confirm('以下の内容で作成します')\r\n    if (!result) return;\r\n\r\n    try {\r\n      await DiaryAPI.insert(\r\n        target.inner_user_id as number,\r\n        date,\r\n        wheather,\r\n        feeling,\r\n        text\r\n      );\r\n\r\n    } catch(e) {\r\n      alert(`作成できませんでした。 詳細: ${e.message}`);\r\n\r\n    } finally {\r\n      setFilter(date, date, false, true);\r\n      onSearch(\"\", date, date);\r\n      setModalStatus(false, null);\r\n    }\r\n  }\r\n}\r\n\r\nfunction getDeleteAndCancelHandler(\r\n  setModalStatus: (open: boolean | null, edit: boolean | null) => void\r\n): () => Promise<void> {\r\n  return async () => {\r\n    const result = window.confirm('入力を破棄してもよろしいですか?');\r\n    if (!result) return;\r\n\r\n    setModalStatus(false, null);\r\n  }\r\n}","import React, { useCallback, useEffect } from 'react';\r\nimport SearchBar from './components/SearchBar';\r\nimport DiaryList from './components/DiaryList';\r\nimport { createStyles, Fab, makeStyles, Theme } from '@material-ui/core';\r\nimport AddIcon from '@material-ui/icons/Add';\r\nimport { Diary } from './model/Diary';\r\nimport DiaryModal from './components/DiaryModal';\r\nimport { useDiaryList, useModal, useSearchBar } from './hooks/DiaryHooks';\r\nimport searchDiaries, { getHandler } from './handlers/SearchHandler';\r\nimport getDiaryTemplate from './handlers/ModalHandler';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => \r\n  createStyles({\r\n    addIcon: {\r\n      position: 'fixed',\r\n      right: '3%',\r\n      bottom: '10%'\r\n    }\r\n  })\r\n);\r\n\r\ntype DiaryRoot = {\r\n  innerUserId: number;\r\n  userInfo: {\r\n    userName: string;\r\n    onLogout: () => void;\r\n  }\r\n};\r\nconst DiaryRoot: React.FC<DiaryRoot> = ({ innerUserId, userInfo }) => {\r\n  const classes = useStyles();\r\n\r\n  const [diaries, original, target, resetPage, setDiaries, setOriginal, setTarget, setResetPage] = useDiaryList();\r\n  const [open, edit, setModalStatus] = useModal(false, false);\r\n  const [filter, setFilter, getDates] = useSearchBar();\r\n\r\n  const onSearch = useCallback(searchDiaries(\r\n    innerUserId,\r\n    setDiaries,\r\n    setOriginal,\r\n    setResetPage,\r\n    getDates\r\n  ), [innerUserId, searchDiaries, setDiaries, setResetPage, getDates]);\r\n\r\n  const onSelected = useCallback((target: Diary) => {\r\n    setTarget(getHandler(\r\n      target,\r\n      setFilter,\r\n      onSearch,\r\n      setModalStatus\r\n    ));\r\n    setModalStatus(true, false);\r\n  }, [onSearch, setFilter, setModalStatus, setTarget]);\r\n\r\n  const onReverse = useCallback((diaries: Diary[]) => setDiaries([...diaries].reverse()), [setDiaries]);\r\n\r\n  const handleModalClose = useCallback(() => setModalStatus(false, null), [setModalStatus]);\r\n\r\n  const createNew = useCallback(() => {\r\n    setTarget(getDiaryTemplate(\r\n      innerUserId, setFilter, onSearch, setModalStatus\r\n    ));\r\n    setModalStatus(true, true);\r\n  }, [innerUserId, setTarget, setModalStatus, setFilter, onSearch]);\r\n  \r\n  const toggleEdit = useCallback(\r\n    () => setModalStatus(null, true), [setModalStatus]\r\n  );\r\n\r\n  // 初回検索\r\n  useEffect(() => {\r\n    onSearch(\"\")\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (  \r\n    <>\r\n      <SearchBar \r\n        onEnter={onSearch} \r\n        filter={filter} \r\n        userInfo={userInfo}\r\n        json={original}\r\n      />\r\n      <DiaryList \r\n        diaries={diaries} \r\n        pageReset={resetPage}\r\n        onSelected={onSelected} \r\n        onReverse={onReverse} \r\n      />\r\n      <DiaryModal \r\n        selectTarget={target} \r\n        open={open} \r\n        edit={edit} \r\n        enterEdit={toggleEdit} \r\n        onClose={handleModalClose}\r\n      />\r\n      <Fab \r\n        color='primary' \r\n        aria-label='add' \r\n        className={classes.addIcon}\r\n        onClick={createNew}\r\n      >\r\n        <AddIcon />\r\n      </Fab>\r\n    </>\r\n  ); \r\n};\r\n\r\nexport default DiaryRoot;","import { MaterialUiPickersDate } from '@material-ui/pickers/typings/date';\r\nimport React, { useState } from 'react';\r\nimport { Filter } from '../components/SearchBar';\r\nimport { Diary, Feeling, Wheather } from '../model/Diary';\r\nimport { SearchResponse } from '../utils/DiaryAPI';\r\nimport { fixDate } from '../utils/TimeUtils';\r\n\r\nexport type SelectTarget = {\r\n  diary: Diary;\r\n  saveHandler: ({ date, wheather, feeling, text }: Diary) => Promise<void>;\r\n  deleteHandler: () => Promise<void>;\r\n  cancelHandler: () => Promise<void>;\r\n};\r\n\r\nexport function useDiaryList(): [\r\n  Diary[],\r\n  SearchResponse,\r\n  SelectTarget,\r\n  boolean,\r\n  React.Dispatch<React.SetStateAction<Diary[]>>,\r\n  React.Dispatch<React.SetStateAction<SearchResponse>>,\r\n  React.Dispatch<React.SetStateAction<SelectTarget>>,\r\n  React.Dispatch<React.SetStateAction<boolean>>\r\n] {\r\n  const [diaries, setDiaries] = useState<Diary[]>([]);\r\n  const [original, setOriginal] = useState<SearchResponse>({ diaries: [] });\r\n\r\n  const [target, setTarget] = useState<SelectTarget>({\r\n    diary: {\r\n      date: new Date(),\r\n      wheather: Wheather.SUNNY,\r\n      feeling: Feeling.HAPPY,\r\n      text: ''\r\n    },\r\n    saveHandler: async ({ date, wheather, feeling, text }) => {return},\r\n    deleteHandler: async () => {return},\r\n    cancelHandler: async () => {return}\r\n  });\r\n  const [resetPage, setResetPage] = useState(false);\r\n\r\n  return [diaries, original, target, resetPage, setDiaries, setOriginal, setTarget, setResetPage];\r\n}\r\n\r\nexport function useModal(init_open: boolean, init_edit: boolean): [\r\n  boolean,\r\n  boolean,\r\n  (open: boolean | null, edit: boolean | null) => void\r\n] {\r\n  const [open, setOpen] = useState(init_open);\r\n  const [edit, setEdit] = useState(init_edit);\r\n\r\n  function setModalStatus(open: boolean | null, edit: boolean | null) {\r\n    open !== null ? setOpen(open) : void(0);\r\n    edit !== null ? setEdit(edit) : void(0);\r\n  }\r\n\r\n  return [open, edit, setModalStatus];\r\n}\r\n\r\ntype useSearchBar = [\r\n  Filter,\r\n  (\r\n    from: Date,\r\n    to: Date,\r\n    fromDisabled: boolean,\r\n    toDisabled: boolean\r\n  ) => void,\r\n  () => [Date|null, Date|null]\r\n];\r\nexport function useSearchBar(): useSearchBar {\r\n  const [toDate, setToDate] = useState<Date>(new Date());\r\n  const [fromDate, setFromDate] = useState<Date>(\r\n    new Date(toDate.getFullYear(), toDate.getMonth()-2, toDate.getDate())\r\n  );\r\n\r\n  const [fromDisabled, setFromDisabled] = useState(false);\r\n  const [toDisabled, setToDisabled] = useState(false);\r\n\r\n  function setFilter(\r\n    from: Date,\r\n    to: Date,\r\n    fromDisabled: boolean,\r\n    toDisabled: boolean\r\n  ): void {\r\n    setFromDate(fixDate(from, true));\r\n    setToDate(fixDate(to, false));\r\n    setFromDisabled(fromDisabled);\r\n    setToDisabled(toDisabled);\r\n  }\r\n\r\n  const filter: Filter = {\r\n    from: {\r\n      date: fromDate,\r\n      onChange: (date: MaterialUiPickersDate) => setFromDate(date as Date),\r\n      onDisabled: (disabled: boolean) => setFromDisabled(disabled),\r\n      disabled: fromDisabled\r\n    },\r\n    to: {\r\n      date: toDate,\r\n      onChange: (date: MaterialUiPickersDate) => setToDate(date as Date),\r\n      onDisabled: (disabled: boolean) => setToDisabled(disabled),\r\n      disabled: toDisabled\r\n    }\r\n  };\r\n\r\n  function getDates(): [Date|null, Date|null] {\r\n    return [fromDisabled ? null : fromDate, toDisabled ? null : toDate];\r\n  }\r\n\r\n  return [filter, setFilter, getDates];\r\n}\r\n\r\n","import React, { useCallback, useRef } from 'react';\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport Button from '@material-ui/core/Button';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Link from '@material-ui/core/Link';\r\nimport Box from '@material-ui/core/Box';\r\nimport LockOutlinedIcon from '@material-ui/icons/LockOutlined';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Container from '@material-ui/core/Container';\r\n\r\nfunction Copyright() {\r\n  return (\r\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\r\n      {'Copyright © '}\r\n      <Link color=\"inherit\" href=\"\">\r\n        Takanori Kusumoto\r\n      </Link>{' '}\r\n      {new Date().getFullYear()}\r\n      {'.'}\r\n    </Typography>\r\n  );\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  paper: {\r\n    marginTop: theme.spacing(16),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n  },\r\n  avatar: {\r\n    margin: theme.spacing(1),\r\n    backgroundColor: theme.palette.primary.main,\r\n  },\r\n  form: {\r\n    width: '100%', // Fix IE 11 issue.\r\n    marginTop: theme.spacing(1),\r\n  },\r\n  submit: {\r\n    margin: theme.spacing(3, 0, 2),\r\n  },\r\n}));\r\n\r\ntype Login = {\r\n  onLogin: (userId: string) => void;\r\n}\r\nexport default function Login({ onLogin }: Login) {\r\n  const classes = useStyles();\r\n\r\n  const idRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const handleOnLogin = useCallback(() => {\r\n    const userId = idRef.current ? idRef.current.value : '';\r\n\r\n    onLogin(userId);\r\n  }, [onLogin]);\r\n\r\n  const handleInputEnter = useCallback((event: React.KeyboardEvent<HTMLDivElement>): void => {\r\n    if ('Enter' !== event.key) return;\r\n\r\n    const userId = idRef.current ? idRef.current.value : '';\r\n\r\n    onLogin(userId);\r\n  }, [onLogin]);\r\n\r\n  return (\r\n    <Container component=\"main\" maxWidth=\"xs\">\r\n      <CssBaseline />\r\n      <div className={classes.paper}>\r\n        <Avatar className={classes.avatar}>\r\n          <LockOutlinedIcon />\r\n        </Avatar>\r\n        <Typography component=\"h1\" variant=\"h5\">\r\n          Login\r\n        </Typography>\r\n        <div className={classes.form}>\r\n          <TextField\r\n            inputRef={idRef}\r\n            onKeyPress={handleInputEnter}\r\n            variant=\"outlined\"\r\n            margin=\"normal\"\r\n            required\r\n            fullWidth\r\n            id=\"user-id\"\r\n            label=\"User ID\"\r\n            name=\"user-id\"\r\n            autoFocus\r\n          />\r\n          <Button\r\n            onClick={handleOnLogin}\r\n            type=\"submit\"\r\n            fullWidth\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            className={classes.submit}\r\n          >\r\n            Login\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      <Box mt={8}>\r\n        <Copyright />\r\n      </Box>\r\n    </Container>\r\n  );\r\n}","import { createMuiTheme } from '@material-ui/core/styles';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#26a69a'\r\n    },\r\n    secondary: {\r\n      main: '#005655'\r\n    }\r\n  }\r\n});\r\n\r\nexport default theme;","import React from 'react';\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\nimport DateFnsUtils from '@date-io/date-fns';\nimport jaLocale from 'date-fns/locale/ja'\n\nimport DiaryRoot from './DiaryRoot';\nimport Login from './Login';\nimport useLogin from './hooks/LoginHooks';\nimport { ThemeProvider } from '@material-ui/core';\nimport theme from './utils/Theme';\n\nfunction App() {\n  const [innerUserId, userName, onLogin, onLogout] = useLogin();\n\n  return (\n    <ThemeProvider theme={theme}>\n      {innerUserId ? (\n        <MuiPickersUtilsProvider utils={DateFnsUtils} locale={jaLocale}>\n          <DiaryRoot \n            innerUserId={innerUserId} \n            userInfo={{\n              userName: userName || '',\n              onLogout: onLogout\n            }}\n          />\n        </MuiPickersUtilsProvider>\n      ):(\n        <Login onLogin={onLogin} />\n      )}\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import { useCallback, useState } from \"react\";\r\n\r\nexport default function useLogin(): [\r\n  number | null,\r\n  string | null,\r\n  (userId: string) => Promise<void>,\r\n  () => void\r\n] {\r\n  const [innerUserId, setInnerUserId] = useState<null | number>(null);\r\n  const [userName, setUserName] = useState<null | string>(null);\r\n\r\n  const onLogin = useCallback(async (userId: string) => {\r\n    if (!userId) {\r\n      alert('ユーザーIDを入力してください');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(`../web_diary/user/${userId}`);\r\n      const userInfo = await res.json();\r\n      if (userInfo.error) {\r\n        alert(`ログインできませんでした。 詳細: ${userInfo.error.message}`);\r\n        return;\r\n      }\r\n      setInnerUserId(userInfo.inner_user_id);\r\n      setUserName(userInfo.user_name);\r\n    } catch(e) {\r\n      alert(`ログインできませんでした。詳細: ${e.message}`);\r\n    }\r\n  }, []);\r\n\r\n  const onLogout = useCallback(() => setInnerUserId(null), []);\r\n\r\n  return [innerUserId, userName, onLogin, onLogout];\r\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\nserviceWorker.unregister();\n"],"sourceRoot":""}